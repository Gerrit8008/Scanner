<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cybersecurity Vulnerability Scanner</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background-color: #f8f9fa;
            font-family: Arial, sans-serif;
        }
        .header {
            background-color: #808588;
            color: white;
            padding: 20px;
            text-align: center;
            margin-bottom: 30px;
        }
        .logo {
            max-width: 150px;
            margin-bottom: 15px;
        }
        .company-info {
            background-color: #808588;
            color: white;
            padding: 20px;
            border-radius: 5px;
            margin-bottom: 20px;
        }
        }
        .logo {
            max-width: 150px;
            margin-bottom: 15px;
        }
        .form-container {
            max-width: 800px;
            margin: 0 auto;
        }
        .form-label {
            font-weight: bold;
        }
        .btn-scan {
            background-color: #FF6900;
            border-color: #FF6900;
            font-weight: bold;
            padding: 10px 30px;
            margin-top: 20px;
        }
        .domain-check {
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #dee2e6;
        }
        .footer {
            background-color: #808588;
            color: white;
            padding: 15px;
            text-align: center;
            margin-top: 50px;
        }
        .loading {
            display: none;
            text-align: center;
            margin: 20px 0;
        }
        .spinner-border {
            width: 3rem;
            height: 3rem;
        }
        .required:after {
            content: " *";
            color: #dc3545;
        }
        .card-header {
            background-color: #FF6900;
            color: white;
            font-weight: bold;
        }
        .progress-container {
            max-width: 800px;
            margin: 0 auto;
            display: none;
        }
        .progress-step {
            margin-bottom: 20px;
        }
        .progress-step h3 {
            margin-bottom: 10px;
        }
        .progress-bar-container {
            height: 30px;
            background-color: #e9ecef;
            border-radius: 5px;
            margin-bottom: 5px;
            overflow: hidden;
        }
        .progress-fill {
            height: 100%;
            background-color: #FF6900;
            border-radius: 5px;
            transition: width 0.5s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }
        .progress-step-status {
            font-weight: bold;
        }
        .status-pending {
            color: #6c757d;
        }
        .status-in-progress {
            color: #FF6900;
        }
        .status-complete {
            color: #28a745;
        }
        .status-error {
            color: #dc3545;
        }
        .enhanced-features {
            background-color: #fff;
            padding: 2rem;
            border-radius: 5px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 2rem;
        }
        .enhanced-features h2 {
            color: #808588;
            border-bottom: 1px solid #eee;
            padding-bottom: 1rem;
        }
    </style>
</head>
<body>
    <div class="header">
        <img src="/static/images/logo.png" alt="Company Logo" class="logo">
        <h1>Cybersecurity Vulnerability Scanner</h1>
        <p>Comprehensive security analysis for your systems and networks</p>
    </div>

    <div class="container">
        <div class="form-container">
            <div class="company-info">
                <h3>Central Georgia Technology</h3>
                <p>320 Dividend Dr, Peachtree City, 30369</p>
                <p>Phone: +1-470-481-0400</p>
            </div>

            <div class="card mb-4">
                <div class="card-header">
                    Complete Security Analysis
                </div>
                <div class="card-body">
                    <p class="card-text">
                        Our comprehensive security scanner analyzes both your system and network vulnerabilities.
                        We combine basic system scanning with enhanced network and web application scanning
                        to provide a complete picture of your security posture.
                    </p>

                    <form id="combinedScanForm" action="/scan" method="post">
                        <div class="mb-3">
                            <label for="name" class="form-label required">Full Name</label>
                            <input type="text" class="form-control" id="name" name="name" required>
                        </div>
                        <div class="mb-3">
                            <label for="email" class="form-label required">Email Address</label>
                            <input type="email" class="form-control" id="email" name="email" required>
                            <div class="form-text">We'll use this to analyze your email security and send you the results.</div>
                        </div>
                        <div class="mb-3">
                            <label for="company" class="form-label">Company Name</label>
                            <input type="text" class="form-control" id="company" name="company">
                        </div>
                        <div class="mb-3">
                            <label for="phone" class="form-label">Phone Number</label>
                            <input type="tel" class="form-control" id="phone" name="phone">
                        </div>
                        
                        <div class="mb-3">
                            <label for="target" class="form-label required">Target Domain or IP</label>
                            <input type="text" class="form-control" id="target" name="target" placeholder="example.com or 192.168.1.1" required>
                            <div class="form-text">Enter a domain name or IP address to scan. Leave blank to scan only your local system.</div>
                        </div>

                        <!-- Hidden fields for client OS detection -->
                        <input type="hidden" id="client_os" name="client_os" value="Unknown">
                        <input type="hidden" id="client_browser" name="client_browser" value="Unknown">
                        <input type="hidden" id="windows_version" name="windows_version" value="">

                        <div class="domain-check">
                            <h3>Comprehensive Security Analysis</h3>
                            <p>
                                We'll analyze:
                            </p>
                            <ul>
                                <li><strong>Your System:</strong> OS security, browser configuration, installed software</li>
                                <li><strong>Email Security:</strong> SPF, DKIM, and DMARC configurations for your domain</li>
                                <li><strong>Network Security:</strong> Open ports, vulnerable services, firewall configuration</li>
                                <li><strong>Web Application:</strong> SSL/TLS configuration, security headers, CMS vulnerabilities</li>
                            </ul>
                        </div>

                        <div class="text-center">
                            <button type="submit" class="btn btn-primary btn-scan btn-lg" id="startScanBtn">Start Comprehensive Scan</button>
                        </div>
                    </form>

                    <div class="loading" id="loadingIndicator">
                        <div class="spinner-border text-primary" role="status">
                            <span class="visually-hidden">Loading...</span>
                        </div>
                        <p class="mt-3">Initializing scan... This may take a few moments.</p>
                    </div>
                </div>
            </div>
            
            <div class="enhanced-features">
                <h2>Advanced Security Scan Features</h2>
                <ul>
                    <li><strong>SSL/TLS Certificate Analysis</strong> - Check for expiration dates, weak encryption, and misconfiguration issues</li>
                    <li><strong>HTTP Security Headers Assessment</strong> - Scan for missing or misconfigured security headers</li>
                    <li><strong>CMS Detection and Vulnerability Checking</strong> - Identify content management systems and check for known vulnerabilities</li>
                    <li><strong>DNS Configuration Analysis</strong> - Examine DNS records for misconfigurations or security issues</li>
                    <li><strong>Email Security Verification</strong> - Check SPF, DKIM, and DMARC records for email security</li>
                    <li><strong>Cookie Security Analysis</strong> - Check for secure flags, HttpOnly settings, and SameSite attributes</li>
                    <li><strong>Web Application Framework Detection</strong> - Identify frameworks and potential known vulnerabilities</li>
                    <li><strong>Basic Content Crawling</strong> - Look for sensitive information exposure in robots.txt or common paths</li>
                    <li><strong>Risk Scoring</strong> - Get an overall security score with recommendations</li>
                    <li><strong>Detailed Report</strong> - Receive a comprehensive security assessment report</li>
                </ul>
            </div>
        </div>
        
        <!-- Scan Progress Container (initially hidden) -->
        <div class="progress-container" id="progressContainer">
            <div class="card">
                <div class="card-header">
                    Scan in Progress
                </div>
                <div class="card-body">
                    <p>Please do not close this window. Your scan results will be displayed once completed.</p>
                    
                    <div class="progress-step">
                        <h3>Overall Progress</h3>
                        <div class="progress-bar-container">
                            <div class="progress-fill" id="overallProgress" style="width: 0%">0%</div>
                        </div>
                    </div>
                    
                    <div class="progress-step">
                        <h3>Initializing Scan</h3>
                        <div class="progress-bar-container">
                            <div class="progress-fill" id="initProgress" style="width: 0%">Pending</div>
                        </div>
                        <p class="progress-step-status status-pending" id="initStatus">⏳ Preparing scan environment...</p>
                    </div>
                    
                    <div class="progress-step">
                        <h3>System Security Analysis</h3>
                        <div class="progress-bar-container">
                            <div class="progress-fill" id="systemProgress" style="width: 0%">Pending</div>
                        </div>
                        <p class="progress-step-status status-pending" id="systemStatus">⏳ Waiting to start system scan...</p>
                    </div>
                    
                    <div class="progress-step">
                        <h3>Network Discovery</h3>
                        <div class="progress-bar-container">
                            <div class="progress-fill" id="discoveryProgress" style="width: 0%">Pending</div>
                        </div>
                        <p class="progress-step-status status-pending" id="discoveryStatus">⏳ Waiting for system analysis to complete</p>
                    </div>
                    
                    <div class="progress-step">
                        <h3>Vulnerability Analysis</h3>
                        <div class="progress-bar-container">
                            <div class="progress-fill" id="vulnProgress" style="width: 0%">Pending</div>
                        </div>
                        <p class="progress-step-status status-pending" id="vulnStatus">⏳ Waiting for network discovery to complete</p>
                    </div>
                    
                    <div class="progress-step">
                        <h3>Web Application Security Audit</h3>
                        <div class="progress-bar-container">
                            <div class="progress-fill" id="webProgress" style="width: 0%">Pending</div>
                        </div>
                        <p class="progress-step-status status-pending" id="webStatus">⏳ Waiting for vulnerability analysis to complete</p>
                    </div>
                    
                    <div class="progress-step">
                        <h3>Report Generation</h3>
                        <div class="progress-bar-container">
                            <div class="progress-fill" id="reportProgress" style="width: 0%">Pending</div>
                        </div>
                        <p class="progress-step-status status-pending" id="reportStatus">⏳ Waiting for security audit to complete</p>
                    </div>
                    
                    <div class="text-center mt-4">
                        <p><strong>Estimated completion time:</strong> <span id="estimatedTime">10 minutes 45 seconds</span></p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="footer">
        <p>&copy; 2025 Central Georgia Technology. All rights reserved.</p>
    </div>

    <script src="{{ url_for('static', filename='js/firewall-test.js') }}"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Function to detect client OS
        function detectClientOS() {
            let os = "Unknown";
            const userAgent = window.navigator.userAgent;
            
            if (userAgent.indexOf("Win") !== -1) os = "Windows";
            else if (userAgent.indexOf("Mac") !== -1) os = "MacOS";
            else if (userAgent.indexOf("Linux") !== -1) os = "Linux";
            else if (userAgent.indexOf("Android") !== -1) os = "Android";
            else if (userAgent.indexOf("iOS") !== -1 || userAgent.indexOf("iPhone") !== -1 || userAgent.indexOf("iPad") !== -1) os = "iOS";
            
            // Set client OS in hidden form fields
            document.getElementById("client_os").value = os;
            
            // Also detect browser
            let browser = "Unknown";
            if (userAgent.indexOf("Chrome") !== -1) browser = "Chrome";
            else if (userAgent.indexOf("Firefox") !== -1) browser = "Firefox";
            else if (userAgent.indexOf("Safari") !== -1) browser = "Safari";
            else if (userAgent.indexOf("Edge") !== -1) browser = "Edge";
            else if (userAgent.indexOf("MSIE") !== -1 || userAgent.indexOf("Trident") !== -1) browser = "Internet Explorer";
            
            document.getElementById("client_browser").value = browser;
            
            // Detect Windows version (approximate)
            let windowsVersion = "";
            if (os === "Windows") {
                if (userAgent.indexOf("Windows NT 10.0") !== -1) windowsVersion = "Windows 10/11";
                else if (userAgent.indexOf("Windows NT 6.3") !== -1) windowsVersion = "Windows 8.1";
                else if (userAgent.indexOf("Windows NT 6.2") !== -1) windowsVersion = "Windows 8";
                else if (userAgent.indexOf("Windows NT 6.1") !== -1) windowsVersion = "Windows 7";
                else windowsVersion = "Older Windows Version";
                
                document.getElementById("windows_version").value = windowsVersion;
            }
            
            console.log("Detected OS:", os, "Browser:", browser, "Windows Version:", windowsVersion);
        }
        
        // Run detection when DOM is loaded
        document.addEventListener('DOMContentLoaded', detectClientOS);
        
        // Form submission
        document.getElementById('combinedScanForm').addEventListener('submit', function(e) {
            e.preventDefault();
            document.getElementById('startScanBtn').disabled = true;
            document.getElementById('loadingIndicator').style.display = 'block';
            
            // For demonstration, show progress after a delay
            setTimeout(function() {
                document.getElementById('loadingIndicator').style.display = 'none';
                document.querySelector('.form-container').style.display = 'none';
                document.getElementById('progressContainer').style.display = 'block';
                
                // Start the progress simulation
                simulateProgress();
            }, 1500);
        });
        
        // Progress simulation function
        function simulateProgress() {
            let overallProgress = 0;
            const updateInterval = 1000;
            
            // Initialize scan
            startInitialization();
            
            function startInitialization() {
                let initProgress = 0;
                document.getElementById('initStatus').className = 'progress-step-status status-in-progress';
                document.getElementById('initStatus').innerHTML = '⟳ Initializing scan environment...';
                
                const initInterval = setInterval(function() {
                    initProgress += Math.floor(Math.random() * 20);
                    if (initProgress >= 100) {
                        initProgress = 100;
                        clearInterval(initInterval);
                        
                        document.getElementById('initProgress').style.width = '100%';
                        document.getElementById('initProgress').textContent = 'Complete';
                        document.getElementById('initStatus').className = 'progress-step-status status-complete';
                        document.getElementById('initStatus').innerHTML = '✓ Scan environment initialized';
                        
                        // Start system analysis
                        startSystemAnalysis();
                    } else {
                        document.getElementById('initProgress').style.width = initProgress + '%';
                        document.getElementById('initProgress').textContent = initProgress + '%';
                    }
                    
                    // Update overall progress
                    updateOverallProgress();
                }, updateInterval);
            }
            
            // System security analysis
            function startSystemAnalysis() {
                let systemProgress = 0;
                document.getElementById('systemStatus').className = 'progress-step-status status-in-progress';
                document.getElementById('systemStatus').innerHTML = '⟳ Analyzing system security...';
                
                const systemInterval = setInterval(function() {
                    systemProgress += Math.floor(Math.random() * 10);
                    if (systemProgress >= 100) {
                        systemProgress = 100;
                        clearInterval(systemInterval);
                        
                        document.getElementById('systemProgress').style.width = '100%';
                        document.getElementById('systemProgress').textContent = 'Complete';
                        document.getElementById('systemStatus').className = 'progress-step-status status-complete';
                        document.getElementById('systemStatus').innerHTML = '✓ System security analysis completed';
                        
                        // Start network discovery
                        startNetworkDiscovery();
                    } else {
                        document.getElementById('systemProgress').style.width = systemProgress + '%';
                        document.getElementById('systemProgress').textContent = systemProgress + '%';
                    }
                    
                    // Update overall progress
                    updateOverallProgress();
                }, updateInterval);
            }
            
            // Network discovery
            function startNetworkDiscovery() {
                let discoveryProgress = 0;
                document.getElementById('discoveryStatus').className = 'progress-step-status status-in-progress';
                document.getElementById('discoveryStatus').innerHTML = '⟳ Scanning network and identifying services...';
                
                const discoveryInterval = setInterval(function() {
                    discoveryProgress += Math.floor(Math.random() * 7);
                    if (discoveryProgress >= 100) {
                        discoveryProgress = 100;
                        clearInterval(discoveryInterval);
                        
                        document.getElementById('discoveryProgress').style.width = '100%';
                        document.getElementById('discoveryProgress').textContent = 'Complete';
                        document.getElementById('discoveryStatus').className = 'progress-step-status status-complete';
                        document.getElementById('discoveryStatus').innerHTML = '✓ Network discovery completed';
                        
                        // Start vulnerability analysis
                        startVulnerabilityAnalysis();
                    } else {
                        document.getElementById('discoveryProgress').style.width = discoveryProgress + '%';
                        document.getElementById('discoveryProgress').textContent = discoveryProgress + '%';
                    }
                    
                    // Update overall progress
                    updateOverallProgress();
                }, updateInterval);
            }
            
            // Start vulnerability analysis
            function startVulnerabilityAnalysis() {
                let vulnProgress = 0;
                document.getElementById('vulnStatus').className = 'progress-step-status status-in-progress';
                document.getElementById('vulnStatus').innerHTML = '⟳ Analyzing system vulnerabilities...';
                
                const vulnInterval = setInterval(function() {
                    vulnProgress += Math.floor(Math.random() * 8);
                    if (vulnProgress >= 100) {
                        vulnProgress = 100;
                        clearInterval(vulnInterval);
                        
                        document.getElementById('vulnProgress').style.width = '100%';
                        document.getElementById('vulnProgress').textContent = 'Complete';
                        document.getElementById('vulnStatus').className = 'progress-step-status status-complete';
                        document.getElementById('vulnStatus').innerHTML = '✓ Vulnerability analysis completed';
                        
                        // Start web application security audit
                        startWebAppAudit();
                    } else {
                        document.getElementById('vulnProgress').style.width = vulnProgress + '%';
                        document.getElementById('vulnProgress').textContent = vulnProgress + '%';
                    }
                    
                    // Update overall progress
                    updateOverallProgress();
                }, updateInterval);
            }
            
            // Start web application security audit
            function startWebAppAudit() {
                let webProgress = 0;
                document.getElementById('webStatus').className = 'progress-step-status status-in-progress';
                document.getElementById('webStatus').innerHTML = '⟳ Auditing web application security...';
                
                const webInterval = setInterval(function() {
                    webProgress += Math.floor(Math.random() * 6);
                    if (webProgress >= 100) {
                        webProgress = 100;
                        clearInterval(webInterval);
                        
                        document.getElementById('webProgress').style.width = '100%';
                        document.getElementById('webProgress').textContent = 'Complete';
                        document.getElementById('webStatus').className = 'progress-step-status status-complete';
                        document.getElementById('webStatus').innerHTML = '✓ Web application security audit completed';
                        
                        // Start report generation
                        startReportGeneration();
                    } else {
                        document.getElementById('webProgress').style.width = webProgress + '%';
                        document.getElementById('webProgress').textContent = webProgress + '%';
                    }
                    
                    // Update overall progress
                    updateOverallProgress();
                }, updateInterval);
            }
            
            // Start report generation
            function startReportGeneration() {
                let reportProgress = 0;
                document.getElementById('reportStatus').className = 'progress-step-status status-in-progress';
                document.getElementById('reportStatus').innerHTML = '⟳ Generating comprehensive report...';
                
                const reportInterval = setInterval(function() {
                    reportProgress += Math.floor(Math.random() * 15);
                    if (reportProgress >= 100) {
                        reportProgress = 100;
                        clearInterval(reportInterval);
                        
                        document.getElementById('reportProgress').style.width = '100%';
                        document.getElementById('reportProgress').textContent = 'Complete';
                        document.getElementById('reportStatus').className = 'progress-step-status status-complete';
                        document.getElementById('reportStatus').innerHTML = '✓ Report generation completed';
                        
                        document.getElementById('overallProgress').style.width = '100%';
                        document.getElementById('overallProgress').textContent = '100%';
                        
                        // Redirect to results page after a short delay
                        setTimeout(function() {
                            window.location.href = '/results';
                        }, 1500);
                    } else {
                        document.getElementById('reportProgress').style.width = reportProgress + '%';
                        document.getElementById('reportProgress').textContent = reportProgress + '%';
                    }
                    
                    // Update overall progress
                    updateOverallProgress();
                }, updateInterval);
            }
            
            // Calculate and update overall progress
            function updateOverallProgress() {
                const init = parseInt(document.getElementById('initProgress').style.width) || 0;
                const system = parseInt(document.getElementById('systemProgress').style.width) || 0;
                const discovery = parseInt(document.getElementById('discoveryProgress').style.width) || 0;
                const vuln = parseInt(document.getElementById('vulnProgress').style.width) || 0;
                const web = parseInt(document.getElementById('webProgress').style.width) || 0;
                const report = parseInt(document.getElementById('reportProgress').style.width) || 0;
                
                overallProgress = Math.floor((init + system + discovery + vuln + web + report) / 6);
                
                document.getElementById('overallProgress').style.width = overallProgress + '%';
                document.getElementById('overallProgress').textContent = overallProgress + '%';
                
                // Update estimated time
                let remainingPercent = 100 - overallProgress;
                let remainingSeconds = Math.floor(remainingPercent * 12);
                let minutes = Math.floor(remainingSeconds / 60);
                let seconds = remainingSeconds % 60;
                
                document.getElementById('estimatedTime').textContent = 
                    minutes + ' minute' + (minutes !== 1 ? 's' : '') + ' ' + 
                    seconds + ' second' + (seconds !== 1 ? 's' : '');
            }
        }
    </script>
</body>
</html>
