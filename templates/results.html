<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Comprehensive Security Scan Results</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.1/font/bootstrap-icons.css">
    <link rel="stylesheet" href="/static/css/styles.css">
</head>
<body>
    <div class="header">
        <div class="container">
            <div class="form-check form-switch float-end">
                <input class="form-check-input" type="checkbox" id="toggleExplanations" checked>
                <label class="form-check-label text-white" for="toggleExplanations">Show Explanations</label>
            </div>
            <img src="/static/images/logo.png" alt="Company Logo" class="logo" onerror="this.style.display='none';">
            <h1>Comprehensive Security Scan Results</h1>
            <p class="mb-0">Scan date: {{ scan.timestamp|default('April 30, 2025') }}</p>
            <!-- Hidden scan_id field for email functionality -->
            <input type="hidden" id="scan-id" value="{{ scan.scan_id|default('') }}">
            
            <!-- Report Action Buttons -->
            <div class="mt-3">
                <button class="btn btn-light me-2" id="emailReportBtn">
                    <i class="bi bi-envelope me-2"></i>Email Report
                </button>
                <button class="btn btn-light" id="printReportBtn">
                    <i class="bi bi-printer me-2"></i>Print Report
                </button>
            </div>
        </div>
    </div>

    <div class="container">
        <!-- Overall Risk Score -->
        <div class="card risk-score my-4">
            {% if scan.risk_assessment and scan.risk_assessment.overall_score is defined %}
            <div class="card-body text-center py-4">
                <div class="score-badge {% if scan.risk_assessment.risk_level == 'Low' %}bg-low{% elif scan.risk_assessment.risk_level == 'Medium' %}bg-medium{% elif scan.risk_assessment.risk_level == 'High' %}bg-high{% else %}bg-critical{% endif %}">
                    <div class="score-value">{{ scan.risk_assessment.overall_score }}</div>
                    <div class="score-label">{{ scan.risk_assessment.risk_level }} RISK</div>
                </div>
                
                <!-- Industry Benchmark Information -->
                {% if scan.industry and scan.industry.benchmarks %}
                <div class="mt-4">
                    <h4>Industry Comparison: {{ scan.industry.name }}</h4>
                    <p>Your security score is <strong>{{ scan.industry.benchmarks.difference }} points {{ scan.industry.benchmarks.comparison }}</strong> 
                       the industry average of {{ scan.industry.benchmarks.avg_score }}.</p>
                    <p>You are in the <strong>{{ scan.industry.benchmarks.percentile }}th percentile</strong> 
                       for your industry.</p>
                </div>
                {% endif %}
            </div>
            {% else %}
            <div class="card-body text-center py-4">
                <div class="score-badge bg-medium">
                    <div class="score-value">N/A</div>
                    <div class="score-label">UNKNOWN</div>
                </div>
            </div>
            {% endif %}
        </div>

        <!-- Executive Summary Section -->
        <div class="card mb-4">
            <div class="card-header">
                <i class="bi bi-clipboard-data"></i>
                <h2 class="mb-0">Executive Summary</h2>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-4 mb-4">
                        <div class="summary-card text-center">
                            <div class="icon-circle">
                                <i class="bi bi-shield-exclamation"></i>
                            </div>
                            <h3>Security Score</h3>
                            {% if scan.risk_assessment and scan.risk_assessment.overall_score is defined %}
                                <div class="summary-value {% if scan.risk_assessment.overall_score > 75 %}text-low{% elif scan.risk_assessment.overall_score > 50 %}text-medium{% else %}text-high{% endif %}">
                                    {{ scan.risk_assessment.overall_score }}/100
                                </div>
                                <div class="progress-bar">
                                    <div class="progress-fill {% if scan.risk_assessment.overall_score > 75 %}bg-low{% elif scan.risk_assessment.overall_score > 50 %}bg-medium{% else %}bg-high{% endif %}" style="width: {{ scan.risk_assessment.overall_score }}%;"></div>
                                </div>
                            {% else %}
                                <div class="summary-value text-medium">
                                    75/100
                                </div>
                                <div class="progress-bar">
                                    <div class="progress-fill bg-medium" style="width: 75%;"></div>
                                </div>
                            {% endif %}
                        </div>
                    </div>
                    
                    <!-- Count Critical and High Issues -->
                    <div class="col-md-4 mb-4">
                        <div class="summary-card text-center">
                            <div class="icon-circle">
                                <i class="bi bi-exclamation-triangle"></i>
                            </div>
                            <h3>Critical Issues</h3>
                            <div class="summary-value text-high" id="critical-issues-count">
                                0
                            </div>
                            <p>Issues requiring immediate attention</p>
                        </div>
                    </div>
                    
                    <div class="col-md-4 mb-4">
                        <div class="summary-card text-center">
                            <div class="icon-circle">
                                <i class="bi bi-check-circle"></i>
                            </div>
                            <h3>Secure Elements</h3>
                            <div class="summary-value text-low" id="secure-elements-count">
                                0
                            </div>
                            <p>Areas with good security practices</p>
                        </div>
                    </div>
                </div>
                
                <div class="alert alert-primary">
                    <strong><i class="bi bi-info-circle-fill me-2"></i> Assessment Overview:</strong>
                    <p class="mb-0">This report provides a comprehensive analysis of your security posture across network, application, and system layers. We've identified key vulnerabilities and provided recommendations to improve your security.</p>
                </div>
            </div>
        </div>

        <!-- Client Information -->
        <div class="card mb-4">
            <div class="card-header">
                <i class="bi bi-person-badge"></i>
                <h2 class="mb-0">Client Information</h2>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6">
                        <p><strong>Name:</strong> {{ scan.client_info.name|default('N/A') }}</p>
                        <p><strong>Email:</strong> {{ scan.email|default(scan.client_info.email|default('N/A')) }}</p>
                        <p><strong>Company:</strong> {{ scan.client_info.company|default('N/A') }}</p>
                    </div>
                    <div class="col-md-6">
                        <p><strong>Operating System:</strong> {{ scan.client_info.os|default('N/A') }}</p>
                        <p><strong>Browser:</strong> {{ scan.client_info.browser|default('N/A') }}</p>
                        <p><strong>Target Domain:</strong> {{ scan.target|default('N/A') }}</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Network Security Section -->
        <div class="card mb-4">
            <div class="card-header">
                <i class="bi bi-hdd-network"></i>
                <h2 class="mb-0">Network Security</h2>
            </div>
            <div class="card-body">
                <div class="explanation-card" id="explanation-network" style="display:block;">
                    <h5><i class="bi bi-info-circle"></i>About Network Security</h5>
                    <p>Network security focuses on protecting the infrastructure and connections that allow systems to communicate. This includes analyzing open ports (potential entry points for attackers), gateway configurations, and firewall settings. Proper network security prevents unauthorized access to your systems and helps maintain operational continuity.</p>
                </div>
                
                <!-- Open Ports -->
                {% if scan.network and scan.network.open_ports %}
                <h3 class="section-title"><i class="bi bi-door-open me-2"></i>Open Ports</h3>
                <div class="finding">
                    <div class="title">
                        <span>Port Scan Results</span>
                        <span class="severity {{ scan.network.open_ports.severity|lower }}">{{ scan.network.open_ports.severity }}</span>
                    </div>
                    <p>Found {{ scan.network.open_ports.count }} open ports that could potentially be access points for attackers.</p>
                    
                    {% if scan.network.open_ports.list %}
                    <div class="table-responsive mt-3">
                        <table class="table table-striped">
                            <thead>
                                <tr>
                                    <th>Port</th>
                                    <th>Service</th>
                                    <th>Risk Level</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for port in scan.network.open_ports.list %}
                                <tr>
                                    <td>{{ port }}</td>
                                    <td>
                                        {% if port == 21 %}FTP (File Transfer Protocol)
                                        {% elif port == 22 %}SSH (Secure Shell)
                                        {% elif port == 23 %}Telnet
                                        {% elif port == 25 %}SMTP (Email)
                                        {% elif port == 80 %}HTTP (Web)
                                        {% elif port == 443 %}HTTPS (Secure Web)
                                        {% elif port == 3389 %}RDP (Remote Desktop)
                                        {% elif port == 5900 %}VNC
                                        {% elif port == 8080 %}HTTP Alternative
                                        {% else %}Unknown
                                        {% endif %}
                                    </td>
                                    <td>
                                        {% if port in [21, 23, 3389, 5900] %}
                                        <span class="badge bg-danger">High Risk</span>
                                        {% elif port in [25, 80, 8080, 110, 143] %}
                                        <span class="badge bg-warning text-dark">Medium Risk</span>
                                        {% else %}
                                        <span class="badge bg-success">Low Risk</span>
                                        {% endif %}
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    {% endif %}
                </div>
                {% endif %}

                <!-- Gateway Analysis -->
                {% if scan.network and scan.network.gateway and scan.network.gateway.results %}
                <h3 class="section-title"><i class="bi bi-router me-2"></i>Gateway Security</h3>
                <div class="finding">
                    <div class="title">
                        <span>Network Gateway Analysis</span>
                        <span class="severity medium">Medium</span>
                    </div>
                    
                    {% if scan.network.gateway.info %}
                    <p><strong>Gateway Info:</strong> {{ scan.network.gateway.info }}</p>
                    {% endif %}
                    
                    <div class="table-responsive mt-3">
                        <table class="table table-striped">
                            <thead>
                                <tr>
                                    <th>Finding</th>
                                    <th>Severity</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for result in scan.network.gateway.results %}
                                <tr>
                                    <td>{{ result[0] }}</td>
                                    <td>
                                        <span class="badge {% if result[1] == 'Critical' %}bg-danger{% elif result[1] == 'High' %}bg-danger{% elif result[1] == 'Medium' %}bg-warning text-dark{% elif result[1] == 'Low' %}bg-success{% else %}bg-info{% endif %}">
                                            {{ result[1] }}
                                        </span>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
                {% endif %}
            </div>
        </div>

        <!-- Web Security Section -->
        <div class="card mb-4">
            <div class="card-header">
                <i class="bi bi-globe"></i>
                <h2 class="mb-0">Web Security</h2>
            </div>
            <div class="card-body">
                <div class="explanation-card" id="explanation-web" style="display:block;">
                    <h5><i class="bi bi-info-circle"></i>About Web Security</h5>
                    <p>Web security focuses on protecting your websites and web applications from common vulnerabilities. This includes analyzing SSL/TLS certificates, security headers, content management systems, and identifying sensitive content exposure. Web attacks are among the most common security threats organizations face today.</p>
                </div>

                <!-- SSL Certificate -->
                {% if scan.ssl_certificate and 'error' not in scan.ssl_certificate %}
                <h3 class="section-title"><i class="bi bi-lock me-2"></i>SSL/TLS Certificate</h3>
                <div class="finding">
                    <div class="title">
                        <span>Certificate Status</span>
                        <span class="severity {{ scan.ssl_certificate.severity|lower }}">{{ scan.ssl_certificate.severity }}</span>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6">
                            <p><strong>Status:</strong> {{ scan.ssl_certificate.status }}</p>
                            <p><strong>Issuer:</strong> {{ scan.ssl_certificate.issuer|default('Unknown') }}</p>
                            <p><strong>Valid Until:</strong> {{ scan.ssl_certificate.valid_until|default('Unknown') }}</p>
                        </div>
                        <div class="col-md-6">
                            <p><strong>Days Remaining:</strong> {{ scan.ssl_certificate.days_remaining|default('Unknown') }}</p>
                            <p><strong>Protocol Version:</strong> {{ scan.ssl_certificate.protocol_version|default('Unknown') }}</p>
                            <p><strong>Weak Protocol:</strong> {{ 'Yes' if scan.ssl_certificate.weak_protocol else 'No' }}</p>
                        </div>
                    </div>
                    
                    {% if scan.ssl_certificate.is_expired %}
                    <div class="alert alert-danger mt-3">
                        <i class="bi bi-exclamation-circle-fill me-2"></i>
                        <strong>Critical Issue:</strong> SSL Certificate is expired and needs to be renewed immediately.
                    </div>
                    {% elif scan.ssl_certificate.expiring_soon %}
                    <div class="alert alert-warning mt-3">
                        <i class="bi bi-exclamation-triangle-fill me-2"></i>
                        <strong>Warning:</strong> SSL Certificate will expire in {{ scan.ssl_certificate.days_remaining }} days.
                    </div>
                    {% endif %}
                    
                    {% if scan.ssl_certificate.weak_protocol %}
                    <div class="alert alert-warning mt-3">
                        <i class="bi bi-exclamation-triangle-fill me-2"></i>
                        <strong>Security Concern:</strong> Using weak SSL/TLS protocol {{ scan.ssl_certificate.protocol_version }}. Upgrade to TLS 1.2 or higher.
                    </div>
                    {% endif %}
                </div>
                {% endif %}

                <!-- Security Headers -->
                {% if scan.security_headers and 'error' not in scan.security_headers %}
                <h3 class="section-title"><i class="bi bi-shield-lock me-2"></i>Security Headers</h3>
                <div class="finding">
                    <div class="title">
                        <span>HTTP Security Headers</span>
                        <span class="severity {{ scan.security_headers.severity|lower }}">{{ scan.security_headers.severity }}</span>
                    </div>
                    
                    <p>Security headers help protect against common web vulnerabilities like XSS, clickjacking, and more.</p>
                    
                    <div class="d-flex justify-content-center my-4">
                        <div style="width: 200px; height: 40px;" class="position-relative bg-light rounded">
                            <div style="width: {{ scan.security_headers.score }}%; height: 100%; background-color: {% if scan.security_headers.score > 75 %}var(--low-color){% elif scan.security_headers.score > 50 %}var(--medium-color){% else %}var(--high-color){% endif %};" class="rounded"></div>
                            <div class="position-absolute top-50 start-50 translate-middle">
                                <strong>{{ scan.security_headers.score }}/100</strong>
                            </div>
                        </div>
                    </div>
                    
                    {% if scan.security_headers.headers %}
                    <div class="table-responsive mt-3">
                        <table class="table table-striped">
                            <thead>
                                <tr>
                                    <th>Header</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for header, found in scan.security_headers.headers.items() %}
                                <tr>
                                    <td>{{ header }}</td>
                                    <td>
                                        {% if found %}
                                        <span class="badge bg-success"><i class="bi bi-check-lg me-1"></i> Present</span>
                                        {% else %}
                                        <span class="badge bg-danger"><i class="bi bi-x-lg me-1"></i> Missing</span>
                                        {% endif %}
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    {% endif %}
                </div>
                {% endif %}
                
                <!-- CMS Detection -->
                {% if scan.cms and scan.cms.cms_detected %}
                <h3 class="section-title"><i class="bi bi-window me-2"></i>Content Management System</h3>
                <div class="finding">
                    <div class="title">
                        <span>CMS Detection</span>
                        <span class="severity {{ scan.cms.severity|lower }}">{{ scan.cms.severity }}</span>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6">
                            <p><strong>CMS Name:</strong> {{ scan.cms.cms_name }}</p>
                            <p><strong>Version:</strong> {{ scan.cms.version|default('Unknown') }}</p>
                        </div>
                        <div class="col-md-6">
                            <p><strong>Risk Level:</strong> {{ scan.cms.severity }}</p>
                        </div>
                    </div>
                    
                    {% if scan.cms.potential_vulnerabilities %}
                    <div class="alert alert-warning mt-3">
                        <i class="bi bi-exclamation-triangle-fill me-2"></i>
                        <strong>Potential Vulnerabilities:</strong>
                        <ul class="mb-0 mt-2">
                            {% for vuln in scan.cms.potential_vulnerabilities %}
                            <li>{{ vuln }}</li>
                            {% endfor %}
                        </ul>
                    </div>
                    {% endif %}
                </div>
                {% endif %}
            </div>
        </div>

        <!-- Email Security Section -->
        <div class="card mb-4">
            <div class="card-header">
                <i class="bi bi-envelope"></i>
                <h2 class="mb-0">Email Security</h2>
            </div>
            <div class="card-body">
                <div class="explanation-card" id="explanation-email" style="display:block;">
                    <h5><i class="bi bi-info-circle"></i>About Email Security</h5>
                    <p>Email security focuses on protecting your email communications from spoofing, phishing, and other attacks. This includes analyzing SPF, DKIM, and DMARC records, which are DNS records that verify email senders and prevent impersonation. Email remains one of the most common attack vectors for organizations.</p>
                </div>

                {% if scan.email_security and 'error' not in scan.email_security %}
                <!-- Display domain -->
                <p><strong>Domain Analyzed:</strong> {{ scan.email_security.domain }}</p>
                
                <!-- SPF Record -->
                <h3 class="section-title"><i class="bi bi-patch-check me-2"></i>Sender Policy Framework (SPF)</h3>
                <div class="finding">
                    <div class="title">
                        <span>SPF Record Status</span>
                        <span class="severity {{ scan.email_security.spf.severity|lower }}">{{ scan.email_security.spf.severity }}</span>
                    </div>
                    
                    <p>{{ scan.email_security.spf.status }}</p>
                    
                    <div class="alert alert-info mt-3">
                        <i class="bi bi-info-circle-fill me-2"></i>
                        <strong>About SPF:</strong> Sender Policy Framework helps prevent email spoofing by specifying which mail servers are authorized to send email on behalf of your domain.
                    </div>
                </div>
                
                <!-- DMARC Record -->
                <h3 class="section-title"><i class="bi bi-patch-check me-2"></i>Domain-based Message Authentication (DMARC)</h3>
                <div class="finding">
                    <div class="title">
                        <span>DMARC Record Status</span>
                        <span class="severity {{ scan.email_security.dmarc.severity|lower }}">{{ scan.email_security.dmarc.severity }}</span>
                    </div>
                    
                    <p>{{ scan.email_security.dmarc.status }}</p>
                    
                    <div class="alert alert-info mt-3">
                        <i class="bi bi-info-circle-fill me-2"></i>
                        <strong>About DMARC:</strong> DMARC builds on SPF and DKIM to protect against email spoofing and phishing by specifying how receiving mail servers should handle messages that fail authentication.
                    </div>
                </div>
                
                <!-- DKIM Record -->
                <h3 class="section-title"><i class="bi bi-patch-check me-2"></i>DomainKeys Identified Mail (DKIM)</h3>
                <div class="finding">
                    <div class="title">
                        <span>DKIM Record Status</span>
                        <span class="severity {{ scan.email_security.dkim.severity|lower }}">{{ scan.email_security.dkim.severity }}</span>
                    </div>
                    
                    <p>{{ scan.email_security.dkim.status }}</p>
                    
                    <div class="alert alert-info mt-3">
                        <i class="bi bi-info-circle-fill me-2"></i>
                        <strong>About DKIM:</strong> DKIM allows receiving mail servers to verify that an email was sent by an authorized sender by cryptographically signing messages.
                    </div>
                </div>
                {% else %}
                <div class="alert alert-warning">
                    <i class="bi bi-exclamation-triangle-fill me-2"></i>
                    <strong>Email Security Scan Not Available:</strong> Either no email domain was provided or there was an error during the scan.
                </div>
                {% endif %}
            </div>
        </div>

        <!-- System Security Section -->
        <div class="card mb-4">
            <div class="card-header">
                <i class="bi bi-pc-display"></i>
                <h2 class="mb-0">System Security</h2>
            </div>
            <div class="card-body">
                <div class="explanation-card" id="explanation-system" style="display:block;">
                    <h5><i class="bi bi-info-circle"></i>About System Security</h5>
                    <p>System security examines the configuration and protection of your operating systems and devices. This includes checking for critical updates, proper firewall configuration, and other system-level protections that form the foundation of your security posture.</p>
                </div>

                {% if scan.system %}
                <!-- OS Updates -->
                {% if scan.system.os_updates %}
                <h3 class="section-title"><i class="bi bi-arrow-repeat me-2"></i>Operating System Updates</h3>
                <div class="finding">
                    <div class="title">
                        <span>OS Update Status</span>
                        <span class="severity {{ scan.system.os_updates.severity|lower }}">{{ scan.system.os_updates.severity }}</span>
                    </div>
                    
                    <p>{{ scan.system.os_updates.message }}</p>
                    
                    <div class="alert alert-info mt-3">
                        <i class="bi bi-info-circle-fill me-2"></i>
                        <strong>Importance:</strong> Keeping your operating system updated is critical for security, as updates often include patches for known vulnerabilities.
                    </div>
                </div>
                {% endif %}
                
                <!-- Firewall Status -->
                {% if scan.system.firewall %}
                <h3 class="section-title"><i class="bi bi-bricks me-2"></i>Firewall Status</h3>
                <div class="finding">
                    <div class="title">
                        <span>Firewall Configuration</span>
                        <span class="severity {{ scan.system.firewall.severity|lower }}">{{ scan.system.firewall.severity }}</span>
                    </div>
                    
                    <p>{{ scan.system.firewall.status }}</p>
                    
                    <div class="alert alert-info mt-3">
                        <i class="bi bi-info-circle-fill me-2"></i>
                        <strong>Importance:</strong> A properly configured firewall is your first line of defense against unauthorized network access and potential attacks.
                    </div>
                </div>
                {% endif %}
                {% else %}
                <div class="alert alert-warning">
                    <i class="bi bi-exclamation-triangle-fill me-2"></i>
                    <strong>System Security Scan Not Available:</strong> System security checks could not be performed on this scan.
                </div>
                {% endif %}
            </div>
        </div>

        <!-- Recommendations Section -->
        <div class="card mb-4">
            <div class="card-header">
                <i class="bi bi-lightbulb"></i>
                <h2 class="mb-0">Security Recommendations</h2>
            </div>
            <div class="card-body">
                <div class="explanation-card" id="explanation-recommendations" style="display:block;">
                    <h5><i class="bi bi-info-circle"></i>About Recommendations</h5>
                    <p>These recommendations provide actionable steps to address the identified security issues. They are prioritized by risk level to help you focus on the most critical vulnerabilities first.</p>
                </div>

                {% if scan.recommendations %}
                <div class="alert alert-primary mb-4">
                    <i class="bi bi-info-circle-fill me-2"></i>
                    <strong>Next Steps:</strong> Based on our scan results, we recommend the following actions to improve your security posture.
                </div>
                
                <div class="recommendations">
                    <ul class="list-group">
                        {% for recommendation in scan.recommendations %}
                        <li class="list-group-item">
                            <i class="bi bi-check-circle-fill me-2 text-success"></i>
                            {{ recommendation }}
                        </li>
                        {% endfor %}
                    </ul>
                </div>
                {% else %}
                <div class="alert alert-warning">
                    <i class="bi bi-exclamation-triangle-fill me-2"></i>
                    <strong>Recommendations Not Available:</strong> We could not generate specific recommendations for this scan.
                </div>
                
                <div class="recommendations">
                    <ul class="list-group">
                        <li class="list-group-item">
                            <i class="bi bi-check-circle-fill me-2 text-success"></i>
                            Keep all software and systems updated with the latest security patches.
                        </li>
                        <li class="list-group-item">
                            <i class="bi bi-check-circle-fill me-2 text-success"></i>
                            Use strong, unique passwords and implement multi-factor authentication where possible.
                        </li>
                        <li class="list-group-item">
                            <i class="bi bi-check-circle-fill me-2 text-success"></i>
                            Regularly back up your data and test the restoration process.
                        </li>
                    </ul>
                </div>
                {% endif %}
            </div>
        </div>

        <!-- Threat Scenarios Section -->
        <div class="card mb-4">
            <div class="card-header">
                <i class="bi bi-exclamation-triangle"></i>
                <h2 class="mb-0">Potential Threat Scenarios</h2>
            </div>
            <div class="card-body">
                <div class="explanation-card" id="explanation-threats" style="display:block;">
                    <h5><i class="bi bi-info-circle"></i>About Threat Scenarios</h5>
                    <p>These scenarios illustrate how the identified vulnerabilities could be exploited by attackers in real-world situations. Understanding these potential threats helps prioritize security improvements and communicate risks to stakeholders.</p>
                </div>

                {% if scan.threat_scenarios %}
                <p>Based on the security vulnerabilities detected, these are potential threat scenarios that could affect your systems:</p>
                
                <div class="row mt-4">
                    {% for threat in scan.threat_scenarios %}
                    <div class="col-lg-6 mb-4">
                        <div class="card h-100 border-warning">
                            <div class="card-header
