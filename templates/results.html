<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Comprehensive Security Scan Results</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.1/font/bootstrap-icons.css">
    <link rel="stylesheet" href="/static/css/styles.css">
</head>
<body>
    <div class="header">
        <div class="container">
            <div class="form-check form-switch float-end">
                <input class="form-check-input" type="checkbox" id="toggleExplanations" checked>
                <label class="form-check-label" for="toggleExplanations">Show Explanations</label>
            </div>
            <img src="/static/images/logo.png" alt="Company Logo" class="logo" onerror="this.style.display='none';">
            <h1>Comprehensive Security Scan Results</h1>
            <p class="mb-0">April 30, 2025</p>
            <!-- Hidden scan_id field for email functionality -->
            <input type="hidden" id="scan-id" value="{{ scan.scan_id }}">
        </div>
    </div>

    <div class="container">
        <!-- Warning Alert for Critical Issues -->
        {% if scan.risk_assessment and scan.risk_assessment.overall_score < 50 %}
        <div id="warningAlert" class="alert alert-danger warning-alert">
            <div class="d-flex align-items-center">
                <i class="bi bi-exclamation-triangle-fill me-3" style="font-size: 2rem;"></i>
                <div>
                    <strong>CRITICAL VULNERABILITIES DETECTED!</strong>
                    <p class="mb-2">Contact us immediately for assistance with the critical security issues identified below.</p>
                    <div class="mt-3">
                        <a href="tel:+14704810400" class="btn btn-danger me-2">
                            <i class="bi bi-telephone-fill me-2"></i> Call Now: 470-481-0400
                        </a>
                        <a href="mailto:sales@cengatech.com" class="btn btn-danger">
                            <i class="bi bi-envelope-fill me-2"></i> Email Us
                        </a>
                    </div>
                </div>
            </div>
        </div>
        {% endif %}

        <!-- Overall Risk Score -->
        <div class="card risk-score fade-in">
            {% if scan.risk_assessment and scan.risk_assessment.overall_score is defined %}
            <div class="score-value {% if scan.risk_assessment.risk_level == 'Low' %}score-low{% elif scan.risk_assessment.risk_level == 'Medium' %}score-medium{% elif scan.risk_assessment.risk_level == 'High' %}score-high{% else %}score-critical{% endif %}">{{ scan.risk_assessment.overall_score }}</div>
            <div class="score-label {% if scan.risk_assessment.risk_level == 'Low' %}score-low{% elif scan.risk_assessment.risk_level == 'Medium' %}score-medium{% elif scan.risk_assessment.risk_level == 'High' %}score-high{% else %}score-critical{% endif %}">{{ scan.risk_assessment.risk_level }} RISK</div>
            {% else %}
            <div class="score-value score-medium">N/A</div>
            <div class="score-label score-medium">RISK LEVEL UNKNOWN</div>
            {% endif %}
        </div>
        
        <!-- Rest of content remains the same, just without the inline styles -->
        <!-- Executive Summary -->
        <div class="card mb-4 fade-in">
            <div class="card-header">
                <h2 class="mb-0">Executive Summary</h2>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-4 mb-4 text-center">
                        <div class="icon-circle">
                            <i class="bi bi-shield-exclamation"></i>
                        </div>
                        <h3>Security Score</h3>
                        <div class="summary-value {% if scan.risk_assessment.overall_score > 75 %}score-low{% elif scan.risk_assessment.overall_score > 50 %}score-medium{% else %}score-high{% endif %}">
                            {{ scan.risk_assessment.overall_score }}/100
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: {{ scan.risk_assessment.overall_score }}%; background-color: {% if scan.risk_assessment.overall_score > 75 %}var(--low-color){% elif scan.risk_assessment.overall_score > 50 %}var(--medium-color){% else %}var(--high-color){% endif %}"></div>
                        </div>
                    </div>
                    
                    <div class="col-md-4 mb-4 text-center">
                        <div class="icon-circle">
                            <i class="bi bi-exclamation-triangle"></i>
                        </div>
                        <h3>Critical Issues</h3>
                        <div class="summary-value text-high">
                            {{ scan.critical_issues|default(2) }}
                        </div>
                        <p>Issues requiring immediate attention</p>
                    </div>
                    
                    <div class="col-md-4 mb-4 text-center">
                        <div class="icon-circle">
                            <i class="bi bi-check-circle"></i>
                        </div>
                        <h3>Secure Elements</h3>
                        <div class="summary-value text-low">
                            {{ scan.secure_elements|default(5) }}
                        </div>
                        <p>Areas with good security practices</p>
                    </div>
                </div>
                
                <div class="alert alert-primary">
                    <strong><i class="bi bi-info-circle-fill me-2"></i> Assessment Overview:</strong>
                    <p class="mb-0">This report provides a comprehensive analysis of your security posture across network, application, and system layers. We've identified key vulnerabilities and provided recommendations to improve your security.</p>
                </div>
            </div>
        </div>

        <!-- Remaining sections continue as in original results.html, but styles are now in the external CSS file -->
        
    </div>

    <div class="footer">
        <div class="container">
            <div class="row">
                <div class="col-md-6 text-center text-md-start mb-3 mb-md-0">
                    <p class="mb-0">&copy; 2025 Central Georgia Technology. All rights reserved.</p>
                </div>
                <div class="col-md-6 text-center text-md-end">
                    <p class="mb-0">470-481-0400 | sales@cengatech.com</p>
                </div>
            </div>
        </div>
    </div>
    
    <button class="print-button" id="floatingPrintBtn" title="Print Report">
        <i class="bi bi-printer"></i>
    </button>

    <!-- JavaScript for toggling explanations and other functionality -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Add explanation class to all explanation divs
            const addExplanationClass = function() {
                // Find all explanation headers (those containing "Understanding")
                const explanationHeaders = Array.from(document.querySelectorAll('.card-header')).filter(
                    header => header.textContent.includes('Understanding')
                );
        
                // Add 'explanation' class to parent card divs
                explanationHeaders.forEach(header => {
                    const card = header.closest('.card');
                    if (card) {
                        card.classList.add('explanation');
                    }
                    });
            };
    
            // Create toggle functionality
            const setupToggle = function() {
                const toggleCheckbox = document.getElementById('toggleExplanations');
        
                if (!toggleCheckbox) {
                    console.warn('Toggle checkbox not found. Skipping explanation toggle setup.');
                    return;
                }
        
                // Function to toggle visibility
                const toggleExplanations = function() {
                    const explanations = document.querySelectorAll('.explanation');
                    const isVisible = toggleCheckbox.checked;
            
                    explanations.forEach(explanation => {
                        explanation.style.display = isVisible ? 'block' : 'none';
                    });
            
                    // Save preference to local storage
                    localStorage.setItem('showExplanations', isVisible);
                };
        
                // Set initial state from local storage if available
                const storedPreference = localStorage.getItem('showExplanations');
                if (storedPreference !== null) {
                    toggleCheckbox.checked = storedPreference === 'true';
                    toggleExplanations();
                }
        
                // Add event listener
                toggleCheckbox.addEventListener('change', toggleExplanations);
            };
    
            // Initialize
            addExplanationClass();
            setupToggle();
            
            // Print functionality
            document.getElementById('printReportBtn').addEventListener('click', function() {
                window.print();
            });
            
            document.getElementById('floatingPrintBtn').addEventListener('click', function() {
                window.print();
            });
            
            // Additional JavaScript functionality would continue as in the original file
        });
    </script>
</body>
</html>
