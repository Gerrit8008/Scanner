<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Comprehensive Security Scan Results</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.1/font/bootstrap-icons.css">
    <link rel="stylesheet" href="/static/css/styles.css">
    <style>
        /* Additional styles for enhanced visuals */
        .animated-progress-fill {
            animation: progressAnimation 1.5s ease-out forwards;
        }
        
        @keyframes progressAnimation {
            0% { width: 0%; }
            100% { width: var(--progress-width); }
        }
        
        .scale-in {
            animation: scaleIn 0.5s ease-out forwards;
            transform: scale(0.8);
            opacity: 0;
        }
        
        @keyframes scaleIn {
            to { transform: scale(1); opacity: 1; }
        }
        
        .score-badge {
            border-radius: 50%;
            width: 170px;
            height: 170px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            margin: 0 auto;
            box-shadow: 0 4px 15px rgba(0,0,0,0.15);
            border: 5px solid white;
        }
        
        .finding {
            transition: transform 0.2s ease;
        }
        
        .finding:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 10px rgba(0,0,0,0.1);
        }
        
        /* Enhanced card header */
        .card-header {
            display: flex;
            align-items: center;
        }
        
        .card-header i {
            margin-right: 10px;
            font-size: 1.4rem;
        }
        
        .header {
            background: linear-gradient(135deg, var(--secondary-color) 0%, #343a40 100%);
        }
        
        .footer {
            background: linear-gradient(135deg, var(--secondary-color) 0%, #343a40 100%);
        }
        
        /* Improved severity badges */
        .severity {
            text-shadow: 0 1px 2px rgba(0,0,0,0.2);
        }
        
        /* Smooth hover transitions */
        .btn, .card, .summary-card {
            transition: all 0.3s ease;
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="container">
            <div class="form-check form-switch float-end">
                <input class="form-check-input" type="checkbox" id="toggleExplanations" checked>
                <label class="form-check-label text-white" for="toggleExplanations">Show Explanations</label>
            </div>
            <img src="/static/images/logo.png" alt="Company Logo" class="logo" onerror="this.style.display='none';">
            <h1>Comprehensive Security Scan Results</h1>
            <p class="mb-0">April 30, 2025</p>
            <!-- Hidden scan_id field for email functionality -->
            <input type="hidden" id="scan-id" value="{{ scan.scan_id }}">
            
            <!-- Report Action Buttons -->
            <div class="mt-3">
                <button class="btn btn-light me-2" id="emailReportBtn">
                    <i class="bi bi-envelope me-2"></i>Email Report
                </button>
                <button class="btn btn-light" id="printReportBtn">
                    <i class="bi bi-printer me-2"></i>Print Report
                </button>
            </div>
        </div>
    </div>

    <div class="container">
        <!-- Warning Alert for Critical Issues -->
        {% if scan.risk_assessment and scan.risk_assessment.overall_score < 50 %}
        <div id="warningAlert" class="alert alert-danger warning-alert scale-in">
            <div class="d-flex align-items-center">
                <i class="bi bi-exclamation-triangle-fill me-3" style="font-size: 2.5rem;"></i>
                <div>
                    <strong>CRITICAL VULNERABILITIES DETECTED!</strong>
                    <p class="mb-2">Contact us immediately for assistance with the critical security issues identified below.</p>
                    <div class="mt-3">
                        <a href="tel:+14704810400" class="btn btn-danger me-2">
                            <i class="bi bi-telephone-fill me-2"></i> Call Now: 470-481-0400
                        </a>
                        <a href="mailto:sales@cengatech.com" class="btn btn-danger">
                            <i class="bi bi-envelope-fill me-2"></i> Email Us
                        </a>
                    </div>
                </div>
            </div>
        </div>
        {% endif %}

        <!-- Overall Risk Score -->
        <div class="card risk-score fade-in my-4">
            {% if scan.risk_assessment and scan.risk_assessment.overall_score is defined %}
            <div class="score-badge {% if scan.risk_assessment.risk_level == 'Low' %}bg-low{% elif scan.risk_assessment.risk_level == 'Medium' %}bg-medium{% elif scan.risk_assessment.risk_level == 'High' %}bg-high{% else %}bg-critical{% endif %} scale-in">
                <div class="score-value text-white">{{ scan.risk_assessment.overall_score }}</div>
                <div class="score-label text-white">{{ scan.risk_assessment.risk_level }} RISK</div>
            </div>
            {% else %}
            <div class="score-badge bg-medium scale-in">
                <div class="score-value text-white">N/A</div>
                <div class="score-label text-white">UNKNOWN</div>
            </div>
            {% endif %}
        </div>
        
        <!-- Executive Summary -->
        <div class="card mb-4 fade-in">
            <div class="card-header">
                <i class="bi bi-clipboard-data"></i>
                <h2 class="mb-0">Executive Summary</h2>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-4 mb-4 text-center">
                        <div class="icon-circle">
                            <i class="bi bi-shield-exclamation"></i>
                        </div>
                        <h3>Security Score</h3>
                        <div class="summary-value {% if scan.risk_assessment.overall_score > 75 %}score-low{% elif scan.risk_assessment.overall_score > 50 %}score-medium{% else %}score-high{% endif %}">
                            {{ scan.risk_assessment.overall_score }}/100
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill animated-progress-fill" style="--progress-width: {{ scan.risk_assessment.overall_score }}%; background-color: {% if scan.risk_assessment.overall_score > 75 %}var(--low-color){% elif scan.risk_assessment.overall_score > 50 %}var(--medium-color){% else %}var(--high-color){% endif %}"></div>
                        </div>
                    </div>
                    
                    <div class="col-md-4 mb-4 text-center">
                        <div class="icon-circle">
                            <i class="bi bi-exclamation-triangle"></i>
                        </div>
                        <h3>Critical Issues</h3>
                        <div class="summary-value text-high">
                            {{ scan.critical_issues|default(2) }}
                        </div>
                        <p>Issues requiring immediate attention</p>
                    </div>
                    
                    <div class="col-md-4 mb-4 text-center">
                        <div class="icon-circle">
                            <i class="bi bi-check-circle"></i>
                        </div>
                        <h3>Secure Elements</h3>
                        <div class="summary-value text-low">
                            {{ scan.secure_elements|default(5) }}
                        </div>
                        <p>Areas with good security practices</p>
                    </div>
                </div>
                
                <div class="alert alert-primary">
                    <strong><i class="bi bi-info-circle-fill me-2"></i> Assessment Overview:</strong>
                    <p class="mb-0">This report provides a comprehensive analysis of your security posture across network, application, and system layers. We've identified key vulnerabilities and provided recommendations to improve your security.</p>
                </div>
            </div>
        </div>

        <!-- Understanding the Executive Summary - Explanation Card -->
        <div class="card mb-4 fade-in explanation">
            <div class="card-header">
                <i class="bi bi-lightbulb"></i>
                <h3 class="mb-0">Understanding the Executive Summary</h3>
            </div>
            <div class="card-body">
                <p>The Executive Summary provides a high-level overview of your security posture:</p>
                <ul>
                    <li><strong>Security Score:</strong> Indicates your overall security level on a scale of 0-100. Higher scores mean better protection.</li>
                    <li><strong>Critical Issues:</strong> Vulnerabilities that require immediate attention due to their high risk potential.</li>
                    <li><strong>Secure Elements:</strong> Areas where your security practices meet or exceed industry standards.</li>
                </ul>
                
                <!-- Dynamic explanation based on score -->
                {% if scan.risk_assessment.overall_score >= 90 %}
                <div class="alert alert-success">
                    <i class="bi bi-check-circle-fill me-2"></i>
                    <strong>Your Score ({{ scan.risk_assessment.overall_score }}):</strong> Excellent! Your security posture is very strong. Continue maintaining these high standards with regular assessments and staying current with evolving threats.
                </div>
                {% elif scan.risk_assessment.overall_score >= 75 %}
                <div class="alert alert-success">
                    <i class="bi bi-check-circle-fill me-2"></i>
                    <strong>Your Score ({{ scan.risk_assessment.overall_score }}):</strong> Good job! Your security measures are effective, though there are some areas that could be improved. Address the medium-risk issues identified to further strengthen your security posture.
                </div>
                {% elif scan.risk_assessment.overall_score >= 60 %}
                <div class="alert alert-warning">
                    <i class="bi bi-exclamation-triangle-fill me-2"></i>
                    <strong>Your Score ({{ scan.risk_assessment.overall_score }}):</strong> Your security posture needs attention. Several vulnerabilities have been detected that could put your systems at risk. Prioritize addressing the high-risk issues identified in this report.
                </div>
                {% elif scan.risk_assessment.overall_score >= 40 %}
                <div class="alert alert-danger">
                    <i class="bi bi-exclamation-triangle-fill me-2"></i>
                    <strong>Your Score ({{ scan.risk_assessment.overall_score }}):</strong> Your systems have significant security gaps that require immediate attention. These vulnerabilities could be exploited by attackers, putting your data and operations at risk.
                </div>
                {% else %}
                <div class="alert alert-danger">
                    <i class="bi bi-x-circle-fill me-2"></i>
                    <strong>Your Score ({{ scan.risk_assessment.overall_score }}):</strong> Critical security issues detected! Your systems are at high risk of compromise. Immediate remediation is strongly recommended to protect your data and systems from attack.
                </div>
                {% endif %}
                
                <div class="alert alert-info mt-3">
                    <i class="bi bi-info-circle-fill me-2"></i>
                    <strong>Why This Matters:</strong> This summary helps you prioritize security efforts based on risk level and potential impact to your organization.
                </div>
            </div>
        </div>

        <!-- Placeholder for Vulnerability Details Section -->
        <div class="card mb-4 fade-in">
            <div class="card-header">
                <i class="bi bi-shield-exclamation"></i>
                <h2 class="mb-0">Vulnerability Details</h2>
            </div>
            <div class="card-body">
                <!-- Critical Findings Section -->
                <h3 class="section-title"><i class="bi bi-exclamation-octagon me-2"></i>Critical Vulnerabilities</h3>
                
                <div class="findings">
                    <!-- Example Critical Finding -->
                    <div class="finding critical">
                        <div class="title">
                            <span>Outdated SSL/TLS Configuration</span>
                            <span class="severity critical">Critical</span>
                        </div>
                        <p>Your system is using outdated SSL protocols (SSLv3/TLSv1.0) which contain known vulnerabilities that can be exploited to perform man-in-the-middle attacks.</p>
                        
                        <div class="recommendations">
                            <h5><i class="bi bi-lightbulb me-2"></i>Recommendations</h5>
                            <ul>
                                <li>Disable SSLv3 and TLSv1.0 protocols immediately</li>
                                <li>Configure servers to use TLSv1.2 or TLSv1.3 only</li>
                                <li>Update cipher suites to only use strong encryption</li>
                            </ul>
                        </div>
                    </div>
                </div>
                
                <!-- High Severity Findings Section -->
                <h3 class="section-title"><i class="bi bi-exclamation-triangle me-2"></i>High Severity Issues</h3>
                
                <div class="findings">
                    <!-- Example High Severity Finding -->
                    <div class="finding high">
                        <div class="title">
                            <span>Missing Security Headers</span>
                            <span class="severity high">High</span>
                        </div>
                        <p>Your web application is missing important security headers that help protect against common web vulnerabilities like XSS, clickjacking, and MIME sniffing attacks.</p>
                        
                        <div class="recommendations">
                            <h5><i class="bi bi-lightbulb me-2"></i>Recommendations</h5>
                            <ul>
                                <li>Implement Content-Security-Policy (CSP) headers</li>
                                <li>Add X-XSS-Protection and X-Frame-Options headers</li>
                                <li>Include Strict-Transport-Security (HSTS) headers</li>
                            </ul>
                        </div>
                    </div>
                </div>
                
                <!-- Example Medium and Low Severity Findings Section -->
                <h3 class="section-title"><i class="bi bi-exclamation-circle me-2"></i>Medium & Low Severity Issues</h3>
                
                <div class="row">
                    <div class="col-md-6">
                        <div class="finding medium">
                            <div class="title">
                                <span>Insecure Cookie Configuration</span>
                                <span class="severity medium">Medium</span>
                            </div>
                            <p>Session cookies are not using the secure and httpOnly flags, which could expose user sessions to theft or hijacking attacks.</p>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="finding low">
                            <div class="title">
                                <span>Server Information Disclosure</span>
                                <span class="severity low">Low</span>
                            </div>
                            <p>HTTP headers are revealing unnecessary information about server software and versions.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Remediation Plan Section -->
        <div class="card mb-4 fade-in">
            <div class="card-header">
                <i class="bi bi-tools"></i>
                <h2 class="mb-0">Remediation Plan</h2>
            </div>
            <div class="card-body">
                <div class="alert alert-info mb-4">
                    <i class="bi bi-info-circle-fill me-2"></i>
                    <strong>Next Steps:</strong> This action plan prioritizes issues based on risk level and implementation difficulty.
                </div>
                
                <div class="table-responsive">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Priority</th>
                                <th>Issue</th>
                                <th>Severity</th>
                                <th>Effort</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>1</td>
                                <td>Upgrade SSL/TLS Configuration</td>
                                <td><span class="badge bg-critical">Critical</span></td>
                                <td>Medium</td>
                                <td><span class="status-indicator status-critical"></span> Not Started</td>
                            </tr>
                            <tr>
                                <td>2</td>
                                <td>Implement Security Headers</td>
                                <td><span class="badge bg-high">High</span></td>
                                <td>Low</td>
                                <td><span class="status-indicator status-critical"></span> Not Started</td>
                            </tr>
                            <tr>
                                <td>3</td>
                                <td>Secure Cookie Configuration</td>
                                <td><span class="badge bg-medium">Medium</span></td>
                                <td>Low</td>
                                <td><span class="status-indicator status-critical"></span> Not Started</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                
                <div class="text-center mt-4">
                    <a href="#" class="btn btn-primary service-inquiry-btn" data-service="Security Remediation" data-findings="3">
                        <i class="bi bi-shield-check me-2"></i> Get Expert Remediation Help
                    </a>
                </div>
            </div>
        </div>
    </div>

    <div class="footer">
        <div class="container">
            <div class="row">
                <div class="col-md-6 text-center text-md-start mb-3 mb-md-0">
                    <p class="mb-0">&copy; 2025 Central Georgia Technology. All rights reserved.</p>
                </div>
                <div class="col-md-6 text-center text-md-end">
                    <p class="mb-0">470-481-0400 | sales@cengatech.com</p>
                </div>
            </div>
        </div>
    </div>
    
    <button class="print-button" id="floatingPrintBtn" title="Print Report">
        <i class="bi bi-printer"></i>
    </button>

    <!-- Service Inquiry Modal -->
    <div class="modal fade" id="serviceInquiryModal" tabindex="-1" aria-labelledby="serviceInquiryModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header bg-primary text-white">
                    <h5 class="modal-title" id="serviceInquiryModalLabel">Learn More About Our Services</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p>We've detected <span id="findingCount" class="text-danger fw-bold">several</span> issues 
                    related to <span id="serviceName" class="fw-bold">security services</span>.</p>
                    
                    <p>Our team can help you address these issues with tailored solutions. 
                    Please provide your information below to receive detailed information about our services:</p>
                    
                    <form id="serviceInquiryForm">
                        <input type="hidden" id="inquiryService" name="service">
                        <input type="hidden" id="inquiryFindings" name="findings">
                        <input type="hidden" id="inquiryScanId" name="scan_id" value="{{ scan.scan_id }}">
                        
                        <div class="mb-3">
                            <label for="inquiryName" class="form-label">Name</label>
                            <input type="text" class="form-control" id="inquiryName" name="name" 
                                   value="{{ scan.client_info.name }}" required>
                        </div>
                        
                        <div class="mb-3">
                            <label for="inquiryEmail" class="form-label">Email</label>
                            <input type="email" class="form-control" id="inquiryEmail" name="email" 
                                   value="{{ scan.client_info.email }}" required>
                        </div>
                        
                        <div class="mb-3">
                            <label for="inquiryPhone" class="form-label">Phone (optional)</label>
                            <input type="tel" class="form-control" id="inquiryPhone" name="phone" 
                                   value="{{ scan.client_info.phone }}">
                        </div>
                        
                        <div class="mb-3">
                            <label for="inquiryMessage" class="form-label">Additional Information</label>
                            <textarea class="form-control" id="inquiryMessage" name="message" rows="3"
                                     placeholder="Please share any specific concerns or questions..."></textarea>
                        </div>
                    </form>
