<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Comprehensive Security Scan Results</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.1/font/bootstrap-icons.css">
    <link rel="stylesheet" href="/static/css/styles.css">
</head>
<body>
    <div class="header">
        <div class="container">
            <div class="form-check form-switch float-end">
                <input class="form-check-input" type="checkbox" id="toggleExplanations" checked>
                <label class="form-check-label" for="toggleExplanations">Show Explanations</label>
            </div>
            <img src="/static/images/logo.png" alt="Company Logo" class="logo" onerror="this.style.display='none';">
            <h1>Comprehensive Security Scan Results</h1>
            <p class="mb-0">April 30, 2025</p>
            <!-- Hidden scan_id field for email functionality -->
            <input type="hidden" id="scan-id" value="{{ scan.scan_id }}">
        </div>
    </div>

    <div class="container">
        <!-- Warning Alert for Critical Issues -->
        {% if scan.risk_assessment and scan.risk_assessment.overall_score < 50 %}
        <div id="warningAlert" class="alert alert-danger warning-alert">
            <div class="d-flex align-items-center">
                <i class="bi bi-exclamation-triangle-fill me-3" style="font-size: 2rem;"></i>
                <div>
                    <strong>CRITICAL VULNERABILITIES DETECTED!</strong>
                    <p class="mb-2">Contact us immediately for assistance with the critical security issues identified below.</p>
                    <div class="mt-3">
                        <a href="tel:+14704810400" class="btn btn-danger me-2">
                            <i class="bi bi-telephone-fill me-2"></i> Call Now: 470-481-0400
                        </a>
                        <a href="mailto:sales@cengatech.com" class="btn btn-danger">
                            <i class="bi bi-envelope-fill me-2"></i> Email Us
                        </a>
                    </div>
                </div>
            </div>
        </div>
        {% endif %}

        <!-- Overall Risk Score -->
        <div class="card risk-score fade-in">
            {% if scan.risk_assessment and scan.risk_assessment.overall_score is defined %}
            <div class="score-value {% if scan.risk_assessment.risk_level == 'Low' %}score-low{% elif scan.risk_assessment.risk_level == 'Medium' %}score-medium{% elif scan.risk_assessment.risk_level == 'High' %}score-high{% else %}score-critical{% endif %}">{{ scan.risk_assessment.overall_score }}</div>
            <div class="score-label {% if scan.risk_assessment.risk_level == 'Low' %}score-low{% elif scan.risk_assessment.risk_level == 'Medium' %}score-medium{% elif scan.risk_assessment.risk_level == 'High' %}score-high{% else %}score-critical{% endif %}">{{ scan.risk_assessment.risk_level }} RISK</div>
            {% else %}
            <div class="score-value score-medium">N/A</div>
            <div class="score-label score-medium">RISK LEVEL UNKNOWN</div>
            {% endif %}
        </div>
        
        <!-- Executive Summary -->
        <div class="card mb-4 fade-in">
            <div class="card-header">
                <h2 class="mb-0">Executive Summary</h2>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-4 mb-4 text-center">
                        <div class="icon-circle">
                            <i class="bi bi-shield-exclamation"></i>
                        </div>
                        <h3>Security Score</h3>
                        <div class="summary-value {% if scan.risk_assessment.overall_score > 75 %}score-low{% elif scan.risk_assessment.overall_score > 50 %}score-medium{% else %}score-high{% endif %}">
                            {{ scan.risk_assessment.overall_score }}/100
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: {{ scan.risk_assessment.overall_score }}%; background-color: {% if scan.risk_assessment.overall_score > 75 %}var(--low-color){% elif scan.risk_assessment.overall_score > 50 %}var(--medium-color){% else %}var(--high-color){% endif %}"></div>
                        </div>
                    </div>
                    
                    <div class="col-md-4 mb-4 text-center">
                        <div class="icon-circle">
                            <i class="bi bi-exclamation-triangle"></i>
                        </div>
                        <h3>Critical Issues</h3>
                        <div class="summary-value text-high">
                            {{ scan.critical_issues|default(2) }}
                        </div>
                        <p>Issues requiring immediate attention</p>
                    </div>
                    
                    <div class="col-md-4 mb-4 text-center">
                        <div class="icon-circle">
                            <i class="bi bi-check-circle"></i>
                        </div>
                        <h3>Secure Elements</h3>
                        <div class="summary-value text-low">
                            {{ scan.secure_elements|default(5) }}
                        </div>
                        <p>Areas with good security practices</p>
                    </div>
                </div>
                
                <div class="alert alert-primary">
                    <strong><i class="bi bi-info-circle-fill me-2"></i> Assessment Overview:</strong>
                    <p class="mb-0">This report provides a comprehensive analysis of your security posture across network, application, and system layers. We've identified key vulnerabilities and provided recommendations to improve your security.</p>
                </div>
            </div>
        </div>
        <div class="card mb-4 fade-in explanation">
    <div class="card-header">
        <h3 class="mb-0">Understanding the Executive Summary</h3>
    </div>
    <div class="card-body">
        <p>The Executive Summary provides a high-level overview of your security posture:</p>
        <ul>
            <li><strong>Security Score:</strong> Indicates your overall security level on a scale of 0-100. Higher scores mean better protection.</li>
            <li><strong>Critical Issues:</strong> Vulnerabilities that require immediate attention due to their high risk potential.</li>
            <li><strong>Secure Elements:</strong> Areas where your security practices meet or exceed industry standards.</li>
        </ul>
        
        <!-- Dynamic explanation based on score -->
        {% if scan.risk_assessment.overall_score >= 90 %}
        <div class="alert alert-success">
            <i class="bi bi-check-circle-fill me-2"></i>
            <strong>Your Score ({{ scan.risk_assessment.overall_score }}):</strong> Excellent! Your security posture is very strong. Continue maintaining these high standards with regular assessments and staying current with evolving threats.
        </div>
        {% elif scan.risk_assessment.overall_score >= 75 %}
        <div class="alert alert-success">
            <i class="bi bi-check-circle-fill me-2"></i>
            <strong>Your Score ({{ scan.risk_assessment.overall_score }}):</strong> Good job! Your security measures are effective, though there are some areas that could be improved. Address the medium-risk issues identified to further strengthen your security posture.
        </div>
        {% elif scan.risk_assessment.overall_score >= 60 %}
        <div class="alert alert-warning">
            <i class="bi bi-exclamation-triangle-fill me-2"></i>
            <strong>Your Score ({{ scan.risk_assessment.overall_score }}):</strong> Your security posture needs attention. Several vulnerabilities have been detected that could put your systems at risk. Prioritize addressing the high-risk issues identified in this report.
        </div>
        {% elif scan.risk_assessment.overall_score >= 40 %}
        <div class="alert alert-danger">
            <i class="bi bi-exclamation-triangle-fill me-2"></i>
            <strong>Your Score ({{ scan.risk_assessment.overall_score }}):</strong> Your systems have significant security gaps that require immediate attention. These vulnerabilities could be exploited by attackers, putting your data and operations at risk.
        </div>
        {% else %}
        <div class="alert alert-danger">
            <i class="bi bi-x-circle-fill me-2"></i>
            <strong>Your Score ({{ scan.risk_assessment.overall_score }}):</strong> Critical security issues detected! Your systems are at high risk of compromise. Immediate remediation is strongly recommended to protect your data and systems from attack.
        </div>
        {% endif %}
        
        <div class="alert alert-info mt-3">
            <i class="bi bi-info-circle-fill me-2"></i>
            <strong>Why This Matters:</strong> This summary helps you prioritize security efforts based on risk level and potential impact to your organization.
        </div>
    </div>
</div>

        <!-- Rest of HTML content remains the same -->
        <!-- Include all the sections from the original results.html file -->
        
    </div>

    <div class="footer">
        <div class="container">
            <div class="row">
                <div class="col-md-6 text-center text-md-start mb-3 mb-md-0">
                    <p class="mb-0">&copy; 2025 Central Georgia Technology. All rights reserved.</p>
                </div>
                <div class="col-md-6 text-center text-md-end">
                    <p class="mb-0">470-481-0400 | sales@cengatech.com</p>
                </div>
            </div>
        </div>
    </div>
    
    <button class="print-button" id="floatingPrintBtn" title="Print Report">
        <i class="bi bi-printer"></i>
    </button>

    <!-- Service Inquiry Modal -->
    <div class="modal fade" id="serviceInquiryModal" tabindex="-1" aria-labelledby="serviceInquiryModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header bg-primary text-white">
                    <h5 class="modal-title" id="serviceInquiryModalLabel">Learn More About Our Services</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p>We've detected <span id="findingCount" class="text-danger fw-bold">several</span> issues 
                    related to <span id="serviceName" class="fw-bold">security services</span>.</p>
                    
                    <p>Our team can help you address these issues with tailored solutions. 
                    Please provide your information below to receive detailed information about our services:</p>
                    
                    <form id="serviceInquiryForm">
                        <input type="hidden" id="inquiryService" name="service">
                        <input type="hidden" id="inquiryFindings" name="findings">
                        <input type="hidden" id="inquiryScanId" name="scan_id" value="{{ scan.scan_id }}">
                        
                        <div class="mb-3">
                            <label for="inquiryName" class="form-label">Name</label>
                            <input type="text" class="form-control" id="inquiryName" name="name" 
                                   value="{{ scan.client_info.name }}" required>
                        </div>
                        
                        <div class="mb-3">
                            <label for="inquiryEmail" class="form-label">Email</label>
                            <input type="email" class="form-control" id="inquiryEmail" name="email" 
                                   value="{{ scan.client_info.email }}" required>
                        </div>
                        
                        <div class="mb-3">
                            <label for="inquiryPhone" class="form-label">Phone (optional)</label>
                            <input type="tel" class="form-control" id="inquiryPhone" name="phone" 
                                   value="{{ scan.client_info.phone }}">
                        </div>
                        
                        <div class="mb-3">
                            <label for="inquiryMessage" class="form-label">Additional Information</label>
                            <textarea class="form-control" id="inquiryMessage" name="message" rows="3"
                                     placeholder="Please share any specific concerns or questions..."></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" id="submitInquiryBtn">Request Information</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Industry Consultation Modal -->
    <div class="modal fade" id="industryConsultationModal" tabindex="-1" aria-labelledby="industryConsultationModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header bg-primary text-white">
                    <h5 class="modal-title" id="industryConsultationModalLabel">
                        {{ scan.industry.name }} Security Consultation
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p>Our security experts specialize in {{ scan.industry.name }} security requirements and compliance.</p>
                    <p>We can help your organization meet industry-specific security standards and best practices.</p>
                
                    <form id="industryConsultationForm">
                        <input type="hidden" id="industryScanId" name="scan_id" value="{{ scan.scan_id }}">
                        <input type="hidden" id="industryType" name="industry" value="{{ scan.industry.type }}">
                    
                        <div class="mb-3">
                            <label for="industryName" class="form-label">Name</label>
                            <input type="text" class="form-control" id="industryName" name="name" 
                                   value="{{ scan.client_info.name }}" required>
                        </div>
                        
                        <div class="mb-3">
                            <label for="industryEmail" class="form-label">Email</label>
                            <input type="email" class="form-control" id="industryEmail" name="email" 
                                   value="{{ scan.client_info.email }}" required>
                        </div>
                        
                        <div class="mb-3">
                            <label for="industryPhone" class="form-label">Phone (optional)</label>
                            <input type="tel" class="form-control" id="industryPhone" name="phone" 
                                   value="{{ scan.client_info.phone }}">
                        </div>
                    
                        <div class="mb-3">
                            <label for="industryMessage" class="form-label">Message</label>
                            <textarea class="form-control" id="industryMessage" name="message" rows="3"
                                     placeholder="Please share your specific security concerns..."></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" id="submitIndustryBtn">Get Consultation</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Add JavaScript for functionality -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Add explanation class to all explanation divs
            const addExplanationClass = function() {
                // Find all explanation headers (those containing "Understanding")
                const explanationHeaders = Array.from(document.querySelectorAll('.card-header')).filter(
                    header => header.textContent.includes('Understanding')
                );
        
                // Add 'explanation' class to parent card divs
                explanationHeaders.forEach(header => {
                    const card = header.closest('.card');
                    if (card) {
                        card.classList.add('explanation');
                    }
                    });
            };
    
            // Create toggle functionality
            const setupToggle = function() {
                const toggleCheckbox = document.getElementById('toggleExplanations');
        
                if (!toggleCheckbox) {
                    console.warn('Toggle checkbox not found. Skipping explanation toggle setup.');
                    return;
                }
        
                // Function to toggle visibility
                const toggleExplanations = function() {
                    const explanations = document.querySelectorAll('.explanation');
                    const isVisible = toggleCheckbox.checked;
            
                    explanations.forEach(explanation => {
                        explanation.style.display = isVisible ? 'block' : 'none';
                    });
            
                    // Save preference to local storage
                    localStorage.setItem('showExplanations', isVisible);
                };
        
                // Set initial state from local storage if available
                const storedPreference = localStorage.getItem('showExplanations');
                if (storedPreference !== null) {
                    toggleCheckbox.checked = storedPreference === 'true';
                    toggleExplanations();
                }
        
                // Add event listener
                toggleCheckbox.addEventListener('change', toggleExplanations);
            };
    
            // Initialize
            addExplanationClass();
            setupToggle();
        });
        // Print functionality
        document.getElementById('printReportBtn').addEventListener('click', function() {
            window.print();
        });
        
        document.getElementById('floatingPrintBtn').addEventListener('click', function() {
            window.print();
        });
        
        // Service inquiry modal handling
        const serviceButtons = document.querySelectorAll('.service-inquiry-btn');
        serviceButtons.forEach(button => {
            button.addEventListener('click', function(e) {
                e.preventDefault();
                const service = this.getAttribute('data-service');
                const findings = this.getAttribute('data-findings');
                
                document.getElementById('serviceName').textContent = service;
                document.getElementById('findingCount').textContent = findings > 0 ? findings : 'several';
                document.getElementById('inquiryService').value = service;
                document.getElementById('inquiryFindings').value = findings;
                
                var modal = new bootstrap.Modal(document.getElementById('serviceInquiryModal'));
                modal.show();
            });
        });
        
        // Industry consultation modal handling
        const industryButton = document.querySelector('.industry-consultation-btn');
        if (industryButton) {
            industryButton.addEventListener('click', function(e) {
                e.preventDefault();
                var modal = new bootstrap.Modal(document.getElementById('industryConsultationModal'));
                modal.show();
            });
        }
        
        // Form submission handlers
        document.getElementById('submitInquiryBtn').addEventListener('click', function() {
            // Add form submission logic here
            alert('Thank you for your inquiry. We will contact you shortly.');
            bootstrap.Modal.getInstance(document.getElementById('serviceInquiryModal')).hide();
        });
        
        if (document.getElementById('submitIndustryBtn')) {
            document.getElementById('submitIndustryBtn').addEventListener('click', function() {
                // Add form submission logic here
                alert('Thank you for your consultation request. Our industry experts will contact you shortly.');
                bootstrap.Modal.getInstance(document.getElementById('industryConsultationModal')).hide();
            });
        }
        
       // Email report button
document.getElementById('emailReportBtn').addEventListener('click', function(e) {
    e.preventDefault();
    const email = prompt('Please enter your email address to receive this report:');
    if (email && email.includes('@')) {
        // Get the scan ID from the hidden input
        const scanId = document.getElementById('scan-id').value;
        
        // Create form data
        const formData = new FormData();
        formData.append('scan_id', scanId);
        formData.append('email', email);
        
        // Show loading message
        alert('Sending report to your email...');
        
        // Send AJAX request to the email report API
        fetch('/api/email_report', {
            method: 'POST',
            body: formData
        })
        .then(response => response.json())
        .then(data => {
            if (data.status === 'success') {
                alert(`Thank you! The report has been sent to ${email}.`);
            } else {
                alert(`Error: ${data.message || 'Failed to send email. Please try again.'}`);
            }
        })
        .catch(error => {
            console.error('Error sending email:', error);
            alert('Failed to send email. Please try again.');
        });
    } else if (email) {
        alert('Please enter a valid email address.');
    }
});
        
        // Add animation effects when scrolling
        document.addEventListener('DOMContentLoaded', function() {
            const cards = document.querySelectorAll('.fade-in');
            
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.style.opacity = 1;
                        entry.target.style.transform = 'translateY(0)';
                    }
                });
            }, { threshold: 0.1 });
            
            cards.forEach(card => {
                card.style.opacity = 0;
                card.style.transform = 'translateY(20px)';
                card.style.transition = 'opacity 0.5s ease, transform 0.5s ease';
                observer.observe(card);
            });
        });
    </script>
</body>
</html>
