<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Comprehensive Security Scan Results</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.1/font/bootstrap-icons.css">
    <link rel="stylesheet" href="/static/css/styles.css">
    <style>
        /* Root variables */
        :root {
            --primary-color: #ff6900;
            --secondary-color: #333;
            --success-color: #28a745;
            --danger-color: #dc3545;
            --light-color: #f8f9fa;
            --dark-color: #212529;
            --border-color: #dee2e6;
            --low-color: #28a745;
            --medium-color: #ffc107;
            --high-color: #dc3545;
            --critical-color: #721c24;
        }

        /* Additional styles for enhanced visuals */
        .animated-progress-fill {
            animation: progressAnimation 1.5s ease-out forwards;
        }
        
        @keyframes progressAnimation {
            0% { width: 0%; }
            100% { width: var(--progress-width); }
        }
        
        .scale-in {
            animation: scaleIn 0.5s ease-out forwards;
            transform: scale(0.8);
            opacity: 0;
        }
        
        @keyframes scaleIn {
            to { transform: scale(1); opacity: 1; }
        }
        
        .score-badge {
            border-radius: 50%;
            width: 170px;
            height: 170px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            margin: 0 auto;
            box-shadow: 0 4px 15px rgba(0,0,0,0.15);
            border: 5px solid white;
        }
        
        .finding {
            transition: transform 0.2s ease;
            background-color: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .finding:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 10px rgba(0,0,0,0.1);
        }
        
        /* Enhanced card header */
        .card-header {
            display: flex;
            align-items: center;
        }
        
        .card-header i {
            margin-right: 10px;
            font-size: 1.4rem;
        }
        
        .header {
            background: linear-gradient(135deg, var(--secondary-color) 0%, #343a40 100%);
            color: white;
            padding: 2rem 0;
            text-align: center;
            margin-bottom: 2rem;
        }
        
        .footer {
            background: linear-gradient(135deg, var(--secondary-color) 0%, #343a40 100%);
            color: white;
            padding: 1.5rem 0;
            margin-top: 3rem;
        }
        
        /* Improved severity badges */
        .severity {
            text-shadow: 0 1px 2px rgba(0,0,0,0.2);
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 0.85rem;
            font-weight: 600;
            text-transform: uppercase;
        }
        
        .severity.critical {
            background-color: var(--critical-color);
            color: white;
        }
        
        .severity.high {
            background-color: var(--high-color);
            color: white;
        }
        
        .severity.medium {
            background-color: var(--medium-color);
            color: #343a40;
        }
        
        .severity.low {
            background-color: var(--low-color);
            color: white;
        }
        
        /* Smooth hover transitions */
        .btn, .card, .summary-card {
            transition: all 0.3s ease;
        }
        
        /* Finding styles */
        .finding .title {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            align-items: center;
        }
        
        .finding .title span {
            font-size: 1.1rem;
            font-weight: 600;
        }
        
        /* Core styles for page appearance */
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 1rem;
        }

        .card {
            border: none;
            border-radius: 10px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.08);
            margin-bottom: 2rem;
        }

        .card-header {
            background-color: #fff;
            border-bottom: 1px solid var(--border-color);
            padding: 1.25rem 1.5rem;
        }

        .card-body {
            padding: 2rem;
            background-color: #fff;
        }
        
        /* Icon styling */
        .icon-circle {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background-color: #f8f9fa;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 15px auto;
            border: 1px solid #e9ecef;
        }
        
        .icon-circle i {
            font-size: 2.5rem;
            color: var(--primary-color);
        }
        
        /* Status indicators */
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 5px;
        }
        
        .status-critical {
            background-color: var(--critical-color);
        }
        
        /* Score values */
        .score-value {
            font-size: 3rem;
            font-weight: bold;
            line-height: 1;
            color: white;
        }
        
        .score-label {
            font-size: 1rem;
            font-weight: 600;
            text-transform: uppercase;
            color: white;
        }
        
        /* Badge backgrounds */
        .bg-critical {
            background-color: var(--critical-color);
        }
        
        .bg-high {
            background-color: var(--high-color);
        }
        
        .bg-medium {
            background-color: var(--medium-color);
        }
        
        .bg-low {
            background-color: var(--low-color);
        }
        
        /* Text colors */
        .text-high {
            color: var(--high-color);
            font-weight: bold;
            font-size: 2rem;
        }
        
        .text-medium {
            color: var(--medium-color);
            font-weight: bold;
            font-size: 2rem;
        }
        
        .text-low {
            color: var(--low-color);
            font-weight: bold;
            font-size: 2rem;
        }
        
        /* Progress bar styles */
        .progress-bar {
            height: 10px;
            background-color: #e9ecef;
            border-radius: 5px;
            overflow: hidden;
            margin-top: 10px;
        }
        
        .progress-fill {
            height: 100%;
            width: 0%;
            border-radius: 5px;
            transition: width 1.5s ease-out;
        }
        
        .summary-value {
            font-size: 2rem;
            font-weight: bold;
            margin: 10px 0;
        }
        
        /* Section titles */
        .section-title {
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 10px;
            margin-top: 30px;
            margin-bottom: 20px;
            color: var(--secondary-color);
        }
        
        /* Print button styling */
        .print-button {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background-color: var(--primary-color);
            color: white;
            border: none;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
            z-index: 1000;
        }
        
        .print-button:hover {
            transform: scale(1.1);
            background-color: #e05e00;
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="container">
            <div class="form-check form-switch float-end">
                <input class="form-check-input" type="checkbox" id="toggleExplanations" checked>
                <label class="form-check-label text-white" for="toggleExplanations">Show Explanations</label>
            </div>
            <img src="/static/images/logo.png" alt="Company Logo" class="logo" onerror="this.style.display='none';">
            <h1>Comprehensive Security Scan Results</h1>
            <p class="mb-0">Scan date: {{ scan.timestamp|default('April 30, 2025') }}</p>
            <!-- Hidden scan_id field for email functionality -->
            <input type="hidden" id="scan-id" value="{{ scan.scan_id|default('') }}">
            
            <!-- Report Action Buttons -->
            <div class="mt-3">
                <button class="btn btn-light me-2" id="emailReportBtn">
                    <i class="bi bi-envelope me-2"></i>Email Report
                </button>
                <button class="btn btn-light" id="printReportBtn">
                    <i class="bi bi-printer me-2"></i>Print Report
                </button>
            </div>
        </div>
    </div>

    <div class="container">
        <!-- Overall Risk Score -->
        <div class="card risk-score my-4">
            {% if scan.risk_assessment and scan.risk_assessment.overall_score is defined %}
            <div class="card-body text-center py-4">
                <div class="score-badge {% if scan.risk_assessment.risk_level == 'Low' %}bg-low{% elif scan.risk_assessment.risk_level == 'Medium' %}bg-medium{% elif scan.risk_assessment.risk_level == 'High' %}bg-high{% else %}bg-critical{% endif %}">
                    <div class="score-value">{{ scan.risk_assessment.overall_score }}</div>
                    <div class="score-label">{{ scan.risk_assessment.risk_level }} RISK</div>
                </div>
            </div>
            {% else %}
            <div class="card-body text-center py-4">
                <div class="score-badge bg-medium">
                    <div class="score-value">N/A</div>
                    <div class="score-label">UNKNOWN</div>
                </div>
            </div>
            {% endif %}
        </div>
        
        <!-- Executive Summary -->
        <div class="card mb-4">
            <div class="card-header">
                <i class="bi bi-clipboard-data"></i>
                <h2 class="mb-0">Executive Summary</h2>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-4 mb-4 text-center">
                        <div class="icon-circle">
                            <i class="bi bi-shield-exclamation"></i>
                        </div>
                        <h3>Security Score</h3>
                        {% if scan.risk_assessment and scan.risk_assessment.overall_score is defined %}
                            <div class="summary-value {% if scan.risk_assessment.overall_score > 75 %}text-low{% elif scan.risk_assessment.overall_score > 50 %}text-medium{% else %}text-high{% endif %}">
                                {{ scan.risk_assessment.overall_score }}/100
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: {{ scan.risk_assessment.overall_score }}%; background-color: {% if scan.risk_assessment.overall_score > 75 %}var(--low-color){% elif scan.risk_assessment.overall_score > 50 %}var(--medium-color){% else %}var(--high-color){% endif %}"></div>
                            </div>
                        {% else %}
                            <div class="summary-value text-medium">
                                75/100
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: 75%; background-color: var(--medium-color)"></div>
                            </div>
                        {% endif %}
                    </div>
                    
                    <div class="col-md-4 mb-4 text-center">
                        <div class="icon-circle">
                            <i class="bi bi-exclamation-triangle"></i>
                        </div>
                        <h3>Critical Issues</h3>
                        <div class="summary-value text-high">
                            {{ scan.critical_issues|default(2) }}
                        </div>
                        <p>Issues requiring immediate attention</p>
                    </div>
                    
                    <div class="col-md-4 mb-4 text-center">
                        <div class="icon-circle">
                            <i class="bi bi-check-circle"></i>
                        </div>
                        <h3>Secure Elements</h3>
                        <div class="summary-value text-low">
                            {{ scan.secure_elements|default(5) }}
                        </div>
                        <p>Areas with good security practices</p>
                    </div>
                </div>
                
                <div class="alert alert-primary">
                    <strong><i class="bi bi-info-circle-fill me-2"></i> Assessment Overview:</strong>
                    <p class="mb-0">This report provides a comprehensive analysis of your security posture across network, application, and system layers. We've identified key vulnerabilities and provided recommendations to improve your security.</p>
                </div>
            </div>
        </div>

        <!-- Vulnerability Details Section -->
        <div class="card mb-4">
            <div class="card-header">
                <i class="bi bi-shield-exclamation"></i>
                <h2 class="mb-0">Vulnerability Details</h2>
            </div>
            <div class="card-body">
                <!-- Critical Findings Section -->
                <h3 class="section-title"><i class="bi bi-exclamation-octagon me-2"></i>Critical Vulnerabilities</h3>
                
                <div class="findings">
                    <!-- Example Critical Finding -->
                    <div class="finding">
                        <div class="title">
                            <span>Outdated SSL/TLS Configuration</span>
                            <span class="severity critical">Critical</span>
                        </div>
                        <p>Your system is using outdated SSL protocols (SSLv3/TLSv1.0) which contain known vulnerabilities that can be exploited to perform man-in-the-middle attacks.</p>
                        
                        <div class="recommendations">
                            <h5><i class="bi bi-lightbulb me-2"></i>Recommendations</h5>
                            <ul>
                                <li>Disable SSLv3 and TLSv1.0 protocols immediately</li>
                                <li>Configure servers to use TLSv1.2 or TLSv1.3 only</li>
                                <li>Update cipher suites to only use strong encryption</li>
                            </ul>
                        </div>
                    </div>
                </div>
                
                <!-- High Severity Findings Section -->
                <h3 class="section-title"><i class="bi bi-exclamation-triangle me-2"></i>High Severity Issues</h3>
                
                <div class="findings">
                    <!-- Example High Severity Finding -->
                    <div class="finding">
                        <div class="title">
                            <span>Missing Security Headers</span>
                            <span class="severity high">High</span>
                        </div>
                        <p>Your web application is missing important security headers that help protect against common web vulnerabilities like XSS, clickjacking, and MIME sniffing attacks.</p>
                        
                        <div class="recommendations">
                            <h5><i class="bi bi-lightbulb me-2"></i>Recommendations</h5>
                            <ul>
                                <li>Implement Content-Security-Policy (CSP) headers</li>
                                <li>Add X-XSS-Protection and X-Frame-Options headers</li>
                                <li>Include Strict-Transport-Security (HSTS) headers</li>
                            </ul>
                        </div>
                    </div>
                </div>
                
                <!-- Example Medium and Low Severity Findings Section -->
                <h3 class="section-title"><i class="bi bi-exclamation-circle me-2"></i>Medium & Low Severity Issues</h3>
                
                <div class="row">
                    <div class="col-md-6">
                        <div class="finding">
                            <div class="title">
                                <span>Insecure Cookie Configuration</span>
                                <span class="severity medium">Medium</span>
                            </div>
                            <p>Session cookies are not using the secure and httpOnly flags, which could expose user sessions to theft or hijacking attacks.</p>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="finding">
                            <div class="title">
                                <span>Server Information Disclosure</span>
                                <span class="severity low">Low</span>
                            </div>
                            <p>HTTP headers are revealing unnecessary information about server software and versions.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Remediation Plan Section -->
        <div class="card mb-4">
            <div class="card-header">
                <i class="bi bi-tools"></i>
                <h2 class="mb-0">Remediation Plan</h2>
            </div>
            <div class="card-body">
                <div class="alert alert-info mb-4">
                    <i class="bi bi-info-circle-fill me-2"></i>
                    <strong>Next Steps:</strong> This action plan prioritizes issues based on risk level and implementation difficulty.
                </div>
                
                <div class="table-responsive">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Priority</th>
                                <th>Issue</th>
                                <th>Severity</th>
                                <th>Effort</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>1</td>
                                <td>Upgrade SSL/TLS Configuration</td>
                                <td><span class="badge bg-danger">Critical</span></td>
                                <td>Medium</td>
                                <td><span class="status-indicator status-critical"></span> Not Started</td>
                            </tr>
                            <tr>
                                <td>2</td>
                                <td>Implement Security Headers</td>
                                <td><span class="badge bg-warning text-dark">High</span></td>
                                <td>Low</td>
                                <td><span class="status-indicator status-critical"></span> Not Started</td>
                            </tr>
                            <tr>
                                <td>3</td>
                                <td>Secure Cookie Configuration</td>
                                <td><span class="badge bg-info text-dark">Medium</span></td>
                                <td>Low</td>
                                <td><span class="status-indicator status-critical"></span> Not Started</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                
                <div class="text-center mt-4">
                    <a href="#" class="btn btn-primary" id="remediation-help-btn">
                        <i class="bi bi-shield-check me-2"></i> Get Expert Remediation Help
                    </a>
                </div>
            </div>
        </div>
    </div>

    <div class="footer">
        <div class="container">
            <div class="row">
                <div class="col-md-6 text-center text-md-start mb-3 mb-md-0">
                    <p class="mb-0">&copy; 2025 Central Georgia Technology. All rights reserved.</p>
                </div>
                <div class="col-md-6 text-center text-md-end">
                    <p class="mb-0">470-481-0400 | sales@cengatech.com</p>
                </div>
            </div>
        </div>
    </div>
    
    <button class="print-button" id="floatingPrintBtn" title="Print Report">
        <i class="bi bi-printer"></i>
    </button>

    <!-- Simple JavaScript for essential functionality -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Log page load
        console.log('Results page loaded at ' + new Date().toLocaleTimeString());

        // Safe function to get element
        function getElement(id) {
            return document.getElementById(id);
        }
        
        // Simple event handling
        document.addEventListener('DOMContentLoaded', function() {
            // Print button
            var printBtn = getElement('printReportBtn');
            if (printBtn) {
                printBtn.addEventListener('click', function() {
                    window.print();
                });
            }
            
            // Floating print button
            var floatingPrintBtn = getElement('floatingPrintBtn');
            if (floatingPrintBtn) {
                floatingPrintBtn.addEventListener('click', function() {
                    window.print();
                });
            }
            
            // Toggle explanations
            var toggleExplanations = getElement('toggleExplanations');
            if (toggleExplanations) {
                toggleExplanations.addEventListener('change', function() {
                    var explanations = document.querySelectorAll('.explanation');
                    explanations.forEach(function(el) {
                        el.style.display = this.checked ? 'block' : 'none';
                    }.bind(this));
                });
            }
            
            // Email report button
            var emailReportBtn = getElement('emailReportBtn');
            if (emailReportBtn) {
                emailReportBtn.addEventListener('click', function() {
                    alert('Email report functionality will be implemented soon.');
                });
            }
            
            // Remediation help button
            var remediationHelpBtn = getElement('remediation-help-btn');
            if (remediationHelpBtn) {
                remediationHelpBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    alert('Our experts will contact you soon to help with remediation.');
                });
            }
            
            // Animate progress fills after page loads
            var progressFills = document.querySelectorAll('.progress-fill');
            progressFills.forEach(function(el) {
                setTimeout(function() {
                    el.style.width = el.style.width || '75%';
                }, 100);
            });
        });
    </script>
</body>
</html>
